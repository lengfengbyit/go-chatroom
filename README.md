# GO 聊天室

### Websocket
> websocket是独立的、创建在TCP上的协议，属于应用层协议， 它通过HTTP/1.1协议的101状态码进行握手


#### 1. websocket 的优点
- 较少的控制开销。连接创建后，在服务器和客户端之间交换数据时，用于协议控制的数据包头部相对较小。在不包含扩展的情况下， 对服务器到客户端的内容，其头部大小只有2字节到10字节(和数据包长度有关)； 对于客户端到服务器的内容，此头部还需额外加上4个字节的掩码。与每次都要携带完整头部的HTTP请求想必，开销明显更低。

- 更强的实时性。由于协议是全双工的，所以服务器可以随时主动给客户端下发数据。

- 保持连接状态。通信时需要先创建连接，是一种有状态的协议。

- 更好的二进制支持。 Websocket 定义了二进制帧，与HTTP相比，可以更轻松地处理二进制内容。

- 支持扩展。 Websocket 定义了扩展，用户可以扩展协议，实现部分自定义的自协议，如两部分浏览器支持压缩。

- 更好的压缩效果。 与HTTP压缩想必， Websocket在适当的扩展支持下， 可以沿用之前内容的上下文，在传递类似的数据时，可以显著提高压缩率。

#### 2. 选择合适的 websocket 库

这里选择 nhooyi.io/websocket, 其优点如下：
- 有很小且符合Go习惯的API
- 一流的context.Context支持
- 有全面的测试
- 不依赖任何第三方库
- 支持JSON和ProtoBuf
- 默认就有高度的性能优化
- 开箱即用的并发支持
- 全面的Wasm支持

